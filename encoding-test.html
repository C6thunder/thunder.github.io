<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–ç æµ‹è¯• - ä¸ªäººç¬”è®°ç½‘ç«™</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #fff 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .test-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4ade80;
        }
        .test-item h3 {
            margin-top: 0;
            color: #4ade80;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            font-family: monospace;
        }
        .pass {
            border-left-color: #4ade80;
        }
        .fail {
            border-left-color: #ef4444;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }
        .chinese-text {
            font-size: 1.2rem;
            margin: 10px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1><i class="fas fa-code"></i> ç¼–ç æµ‹è¯•å·¥å…·</h1>

        <div class="test-item">
            <h3><i class="fas fa-globe"></i> 1. é¡µé¢ç¼–ç æ£€æµ‹</h3>
            <p>æ£€æµ‹å½“å‰é¡µé¢çš„å­—ç¬¦ç¼–ç è®¾ç½®</p>
            <div class="test-result" id="encodingTest">
                æ­£åœ¨æ£€æµ‹...
            </div>
        </div>

        <div class="test-item">
            <h3><i class="fas fa-keyboard"></i> 2. ä¸­æ–‡æ–‡æœ¬æ˜¾ç¤ºæµ‹è¯•</h3>
            <p>ä»¥ä¸‹ä¸­æ–‡æ–‡æœ¬åº”è¯¥æ­£ç¡®æ˜¾ç¤ºï¼š</p>
            <div class="chinese-text">
                æ¬¢è¿ä½¿ç”¨ä¸ªäººç¬”è®°ç½‘ç«™ï¼è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•ã€‚
            </div>
            <div class="chinese-text">
                å¸¸ç”¨ä¸­æ–‡å­—ç¬¦ï¼šä½ å¥½ä¸–ç•Œã€ä»Šå¤©å¤©æ°”ä¸é”™ã€å­¦ä¹ ç¼–ç¨‹ã€ä»£ç å†™å¾—å¥½
            </div>
            <div class="chinese-text">
                ç‰¹æ®Šç¬¦å·ï¼šâ˜… â˜† â™¥ â™¡ âš¡ âœ¨ ğŸ‰ ğŸŠ
            </div>
        </div>

        <div class="test-item">
            <h3><i class="fas fa-cogs"></i> 3. JavaScriptç¼–ç æµ‹è¯•</h3>
            <p>æµ‹è¯•JavaScriptçš„UTF-8ç¼–è§£ç èƒ½åŠ›</p>
            <div class="test-result" id="jsTest">
                æ­£åœ¨æµ‹è¯•...
            </div>
            <button class="btn" onclick="runJSTest()">é‡æ–°æµ‹è¯•</button>
        </div>

        <div class="test-item">
            <h3><i class="fas fa-github"></i> 4. GitHub APIè¿æ¥æµ‹è¯•</h3>
            <p>æµ‹è¯•GitHub APIçš„UTF-8æ”¯æŒ</p>
            <div class="test-result" id="githubTest">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•
            </div>
            <button class="btn" onclick="testGitHub()">
                <i class="fab fa-github"></i> æµ‹è¯•GitHubè¿æ¥
            </button>
        </div>

        <div class="test-item">
            <h3><i class="fas fa-refresh"></i> 5. ç¼–ç ä¿®å¤åŠŸèƒ½</h3>
            <p>è¿è¡Œç¼–ç è‡ªåŠ¨ä¿®å¤å’ŒéªŒè¯</p>
            <div class="test-result" id="fixTest">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿è¡Œ
            </div>
            <button class="btn" onclick="runFixTest()">
                <i class="fas fa-wrench"></i> è¿è¡Œç¼–ç ä¿®å¤
            </button>
        </div>
    </div>

    <script src="github-api.js"></script>
    <script>
        // 1. é¡µé¢ç¼–ç æ£€æµ‹
        function checkEncoding() {
            const encoding = document.characterSet;
            const hasMetaCharset = document.querySelector('meta[charset]') !== null;
            const hasHttpEquiv = document.querySelector('meta[http-equiv="Content-Type"]') !== null;

            const result = `
é¡µé¢ç¼–ç : ${encoding}
HTML charsetæ ‡ç­¾: ${hasMetaCharset ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®'}
HTTP-equivæ ‡ç­¾: ${hasHttpEquiv ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®'}
æµè§ˆå™¨è¯­è¨€: ${navigator.language}
            `.trim();

            document.getElementById('encodingTest').textContent = result;
        }

        // 3. JavaScriptç¼–ç æµ‹è¯•
        function runJSTest() {
            const testStrings = [
                'ä½ å¥½ä¸–ç•Œ',
                'Testä¸­æ–‡æ··åˆ123',
                'ç‰¹æ®Šå­—ç¬¦ï¼šâ˜…â˜†â™¥â™¡',
                'emojiæµ‹è¯•ï¼šğŸ‰ğŸŠâœ¨'
            ];

            const encoder = new TextEncoder();
            const decoder = new TextDecoder('utf-8', { fatal: false });

            let allPass = true;
            let result = '';

            testStrings.forEach((str, i) => {
                const encoded = encoder.encode(str);
                const decoded = decoder.decode(encoded);
                const pass = decoded === str;
                allPass = allPass && pass;

                result += `æµ‹è¯• ${i + 1}: ${pass ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
                result += `åŸæ–‡: ${str}\n`;
                result += `è§£ç : ${decoded}\n\n`;
            });

            result += `\næ€»ä½“ç»“æœ: ${allPass ? 'âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡' : 'âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}`;
            document.getElementById('jsTest').textContent = result;

            const testItem = document.getElementById('jsTest').parentElement;
            testItem.className = 'test-item ' + (allPass ? 'pass' : 'fail');
        }

        // 4. GitHub APIæµ‹è¯•
        async function testGitHub() {
            const resultEl = document.getElementById('githubTest');
            resultEl.textContent = 'æ­£åœ¨è¿æ¥GitHub...';

            try {
                // æ¨¡æ‹Ÿæµ‹è¯•
                const testData = {
                    title: 'ç¼–ç æµ‹è¯•ç¬”è®°',
                    content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä¸­æ–‡ç¼–ç çš„ç¬”è®°å†…å®¹ï¼šä½ å¥½ä¸–ç•Œ123ï¼',
                    date: new Date().toISOString().split('T')[0]
                };

                const jsonString = JSON.stringify(testData, null, 2);
                const utf8Bytes = new TextEncoder().encode(jsonString);
                const base64Content = btoa(String.fromCharCode(...utf8Bytes));

                // æµ‹è¯•base64ç¼–è§£ç 
                const decodedBytes = Uint8Array.from(atob(base64Content), c => c.charCodeAt(0));
                const decodedString = new TextDecoder('utf-8').decode(decodedBytes);
                const parsedData = JSON.parse(decodedString);

                if (parsedData.content === testData.content) {
                    resultEl.textContent = 'âœ… GitHub API UTF-8ç¼–ç æµ‹è¯•é€šè¿‡\nJSONå†…å®¹æ­£ç¡®è§£æå’Œæ˜¾ç¤º';
                    resultEl.parentElement.className = 'test-item pass';
                } else {
                    resultEl.textContent = 'âŒ GitHub APIç¼–ç æµ‹è¯•å¤±è´¥';
                    resultEl.parentElement.className = 'test-item fail';
                }
            } catch (error) {
                resultEl.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
                resultEl.parentElement.className = 'test-item fail';
            }
        }

        // 5. ç¼–ç ä¿®å¤æµ‹è¯•
        function runFixTest() {
            const resultEl = document.getElementById('fixTest');
            resultEl.textContent = 'æ­£åœ¨è¿è¡Œç¼–ç ä¿®å¤...';

            if (typeof window.fixEncodingIssues === 'function') {
                const result = window.fixEncodingIssues();
                resultEl.textContent = result
                    ? 'âœ… ç¼–ç éªŒè¯é€šè¿‡ï¼Œæ‰€æœ‰è®¾ç½®æ­£ç¡®'
                    : 'âš ï¸ ç¼–ç éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®';
                resultEl.parentElement.className = 'test-item ' + (result ? 'pass' : 'fail');
            } else {
                resultEl.textContent = 'âŒ fixEncodingIssueså‡½æ•°æœªæ‰¾åˆ°';
                resultEl.parentElement.className = 'test-item fail';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæ£€æµ‹
        window.addEventListener('DOMContentLoaded', function() {
            checkEncoding();
            runJSTest();

            setTimeout(() => {
                if (typeof window.fixEncodingIssues === 'function') {
                    console.log('ğŸ”§ è¿è¡Œè‡ªåŠ¨ç¼–ç ä¿®å¤...');
                    const result = window.fixEncodingIssues();
                    console.log('ç¼–ç ä¿®å¤ç»“æœ:', result);
                }
            }, 500);
        });
    </script>
</body>

</html>
